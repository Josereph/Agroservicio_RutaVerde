{% extends "layouts/base.html" %}

{% block title %}Sistema de Alertas - Agroservicio Ruta Verde{% endblock %}

{% block content %}
<link rel="stylesheet" href="/static/css/Alertas.css">

<!-- Hero Section -->
<div class="alertas-hero-section">
    <div class="container-fluid">
        <div class="hero-content">
            <div class="hero-badge">
                <i class="bi bi-bell-fill"></i>
                <span>Sistema de Monitoreo</span>
            </div>
            <h1 class="hero-title">Centro de Alertas</h1>
            <p class="hero-subtitle">Monitoreo en Tiempo Real de Operaciones Log铆sticas</p>
        </div>
    </div>
</div>

<!-- Resumen de Alertas -->
<div class="container-fluid alertas-stats-section">
    <div class="row">
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="alerta-stat-card critica">
                <div class="stat-icon-wrapper">
                    <i class="bi bi-exclamation-triangle-fill"></i>
                </div>
                <div class="stat-info">
                    <h3 class="stat-value">{{ stats.criticas }}</h3>
                    <p class="stat-description">Alertas Cr铆ticas</p>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6 mb-4">
            <div class="alerta-stat-card alta">
                <div class="stat-icon-wrapper">
                    <i class="bi bi-exclamation-circle-fill"></i>
                </div>
                <div class="stat-info">
                    <h3 class="stat-value">{{ stats.altas }}</h3>
                    <p class="stat-description">Prioridad Alta</p>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6 mb-4">
            <div class="alerta-stat-card media">
                <div class="stat-icon-wrapper">
                    <i class="bi bi-info-circle-fill"></i>
                </div>
                <div class="stat-info">
                    <h3 class="stat-value">{{ stats.medias }}</h3>
                    <p class="stat-description">Prioridad Media</p>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6 mb-4">
            <div class="alerta-stat-card baja">
                <div class="stat-icon-wrapper">
                    <i class="bi bi-bell-fill"></i>
                </div>
                <div class="stat-info">
                    <h3 class="stat-value">{{ stats.bajas }}</h3>
                    <p class="stat-description">Prioridad Baja</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tabla de Alertas Activas -->
{% if alertas and alertas|length > 0 %}
<div class="container-fluid alertas-activas-section">
    <div class="section-header text-center">
        <span class="section-label">Alertas Activas</span>
        <h2 class="section-title">Requieren Atenci贸n Inmediata</h2>
        <p class="text-muted">Total de alertas: {{ stats.total }}</p>
    </div>

    <div class="row mt-4">
        <div class="col-12">
            <div class="table-responsive">
                <table class="table table-hover align-middle alertas-table">
                    <thead>
                        <tr>
                            <th>Prioridad</th>
                            <th>Categor铆a</th>
                            <th>T铆tulo</th>
                            <th>Descripci贸n</th>
                            <th>Servicio</th>
                            <th>Fecha</th>
                            <th>Acci贸n</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for alerta in alertas %}
                        <tr>
                            <td>
                                {% if alerta.prioridad == 'critica' %}
                                    <span class="badge bg-danger px-3 py-2"> Cr铆tica</span>
                                {% elif alerta.prioridad == 'alta' %}
                                    <span class="badge bg-warning text-dark px-3 py-2"> Alta</span>
                                {% elif alerta.prioridad == 'media' %}
                                    <span class="badge px-3 py-2" style="background-color: #ffc107; color: #000;"> Media</span>
                                {% else %}
                                    <span class="badge bg-info px-3 py-2"> Baja</span>
                                {% endif %}
                            </td>
                            <td>
                                <span class="badge bg-secondary">{{ alerta.categoria|title }}</span>
                            </td>
                            <td class="text-start">
                                <strong>{{ alerta.titulo }}</strong>
                            </td>
                            <td class="text-start">{{ alerta.descripcion }}</td>
                            <td>
                                <a href="{{ url_for('main.gestion_evidencia') }}?servicio={{ alerta.id_servicio }}" 
                                   class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-box-seam"></i> #{{ alerta.id_servicio }}
                                </a>
                            </td>
                            <td><small>{{ alerta.fecha.strftime('%d/%m/%Y %H:%M') }}</small></td>
                            <td>
                                <a href="{{ url_for('main.gestion_evidencia') }}" 
                                   class="btn btn-sm btn-success">
                                    <i class="bi bi-eye"></i> Ver
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Secci贸n: Categor铆as de Alertas -->
<div class="container-fluid alertas-categorias-section">
    <div class="section-header text-center">
        <span class="section-label">Categor铆as de Monitoreo</span>
        <h2 class="section-title">Tipos de Alertas del Sistema</h2>
    </div>

    <div class="row mt-5">
        <!-- Alertas de Veh铆culos -->
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="categoria-card">
                <div class="categoria-icon vehiculos">
                    <i class="bi bi-truck"></i>
                </div>
                <h4 class="categoria-title">Veh铆culos</h4>
                <ul class="categoria-lista">
                    <li><i class="bi bi-check2"></i> Mantenimiento preventivo</li>
                    <li><i class="bi bi-check2"></i> Vencimiento de seguros</li>
                    <li><i class="bi bi-check2"></i> Kilometraje alto</li>
                    <li><i class="bi bi-check2"></i> Estado operativo</li>
                </ul>
                <div class="categoria-badge">
                    <span class="badge {% if por_categoria.vehiculos > 0 %}bg-danger{% else %}bg-secondary{% endif %}">
                        {{ por_categoria.vehiculos }} activas
                    </span>
                </div>
            </div>
        </div>

        <!-- Alertas de Conductores -->
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="categoria-card">
                <div class="categoria-icon conductores">
                    <i class="bi bi-person-badge"></i>
                </div>
                <h4 class="categoria-title">Conductores</h4>
                <ul class="categoria-lista">
                    <li><i class="bi bi-check2"></i> Licencias por vencer</li>
                    <li><i class="bi bi-check2"></i> Licencias vencidas</li>
                    <li><i class="bi bi-check2"></i> Disponibilidad</li>
                    <li><i class="bi bi-check2"></i> Capacitaciones pendientes</li>
                </ul>
                <div class="categoria-badge">
                    <span class="badge {% if por_categoria.conductores > 0 %}bg-warning{% else %}bg-secondary{% endif %}">
                        {{ por_categoria.conductores }} activas
                    </span>
                </div>
            </div>
        </div>

        <!-- Alertas de Servicios -->
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="categoria-card">
                <div class="categoria-icon servicios">
                    <i class="bi bi-box-seam"></i>
                </div>
                <h4 class="categoria-title">Servicios/Env铆os</h4>
                <ul class="categoria-lista">
                    <li><i class="bi bi-check2"></i> Retrasos en entregas</li>
                    <li><i class="bi bi-check2"></i> Incidentes en ruta</li>
                    <li><i class="bi bi-check2"></i> Control de calidad</li>
                    <li><i class="bi bi-check2"></i> Evidencias faltantes</li>
                </ul>
                <div class="categoria-badge">
                    <span class="badge {% if por_categoria.servicios > 0 %}bg-info{% else %}bg-secondary{% endif %}">
                        {{ por_categoria.servicios }} activas
                    </span>
                </div>
            </div>
        </div>

        <!-- Alertas de Documentaci贸n -->
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="categoria-card">
                <div class="categoria-icon documentacion">
                    <i class="bi bi-file-earmark-text"></i>
                </div>
                <h4 class="categoria-title">Documentaci贸n</h4>
                <ul class="categoria-lista">
                    <li><i class="bi bi-check2"></i> Documentos ilegibles</li>
                    <li><i class="bi bi-check2"></i> Documentaci贸n vencida</li>
                    <li><i class="bi bi-check2"></i> Firmas pendientes</li>
                    <li><i class="bi bi-check2"></i> Fotograf铆as faltantes</li>
                </ul>
                <div class="categoria-badge">
                    <span class="badge {% if por_categoria.documentacion > 0 %}bg-danger{% else %}bg-secondary{% endif %}">
                        {{ por_categoria.documentacion }} activas
                    </span>
                </div>
            </div>
        </div>

        <!-- Alertas de Inventario -->
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="categoria-card">
                <div class="categoria-icon inventario">
                    <i class="bi bi-clipboard-data"></i>
                </div>
                <h4 class="categoria-title">Inventario</h4>
                <ul class="categoria-lista">
                    <li><i class="bi bi-check2"></i> Stock bajo</li>
                    <li><i class="bi bi-check2"></i> Productos por vencer</li>
                    <li><i class="bi bi-check2"></i> Sobrecarga de pedidos</li>
                    <li><i class="bi bi-check2"></i> Disponibilidad</li>
                </ul>
                <div class="categoria-badge">
                    <span class="badge {% if por_categoria.inventario > 0 %}bg-warning{% else %}bg-secondary{% endif %}">
                        {{ por_categoria.inventario }} activas
                    </span>
                </div>
            </div>
        </div>

        <!-- Alertas Cr铆ticas del Sistema -->
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="categoria-card">
                <div class="categoria-icon sistema">
                    <i class="bi bi-shield-exclamation"></i>
                </div>
                <h4 class="categoria-title">Alertas Cr铆ticas</h4>
                <ul class="categoria-lista">
                    <li><i class="bi bi-check2"></i> Accidentes reportados</li>
                    <li><i class="bi bi-check2"></i> Condiciones clim谩ticas</li>
                    <li><i class="bi bi-check2"></i> Errores de pago</li>
                    <li><i class="bi bi-check2"></i> Rutas bloqueadas</li>
                </ul>
                <div class="categoria-badge">
                    <span class="badge {% if por_categoria.sistema > 0 %}bg-dark{% else %}bg-secondary{% endif %}">
                        {{ por_categoria.sistema }} activas
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Secci贸n: Estado Actual -->
{% if not alertas or alertas|length == 0 %}
<div class="container-fluid alertas-estado-section">
    <div class="row align-items-center">
        <div class="col-lg-6 mb-4">
            <div class="estado-content">
                <span class="section-label">Estado Operativo</span>
                <h2 class="section-title">Sistema sin Alertas Activas</h2>
                <p class="section-description">
                    Actualmente no hay alertas registradas en el sistema. Todas las 
                    operaciones est谩n funcionando dentro de los par谩metros normales.
                </p>
                <div class="estado-detalles">
                    <div class="detalle-item">
                        <i class="bi bi-check-circle-fill text-success"></i>
                        <span>Todos los veh铆culos operativos</span>
                    </div>
                    <div class="detalle-item">
                        <i class="bi bi-check-circle-fill text-success"></i>
                        <span>Conductores con documentaci贸n vigente</span>
                    </div>
                    <div class="detalle-item">
                        <i class="bi bi-check-circle-fill text-success"></i>
                        <span>Entregas dentro del tiempo estimado</span>
                    </div>
                    <div class="detalle-item">
                        <i class="bi bi-check-circle-fill text-success"></i>
                        <span>Documentaci贸n completa y actualizada</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6 mb-4">
            <div class="estado-visual">
                <div class="sistema-ok-icon">
                    <i class="bi bi-shield-check"></i>
                </div>
                <h3 class="sistema-ok-text">Sistema Operando Normalmente</h3>
                <p class="sistema-ok-descripcion">Monitoreo activo 24/7</p>
            </div>
        </div>
    </div>
</div>
{% else %}
<!-- Si hay alertas, mostrar resumen -->
<div class="container-fluid alertas-estado-section">
    <div class="row align-items-center">
        <div class="col-lg-6 mb-4">
            <div class="estado-content">
                <span class="section-label">Estado Operativo</span>
                <h2 class="section-title">Sistema con Alertas Activas</h2>
                <p class="section-description">
                    Se han detectado {{ stats.total }} alerta(s) que requieren atenci贸n. 
                    Revisa la tabla superior para ver los detalles y tomar las acciones necesarias.
                </p>
                <div class="estado-detalles">
                    {% if stats.criticas > 0 %}
                    <div class="detalle-item">
                        <i class="bi bi-exclamation-triangle-fill text-danger"></i>
                        <span>{{ stats.criticas }} alerta(s) cr铆tica(s) - Acci贸n inmediata</span>
                    </div>
                    {% endif %}
                    {% if stats.altas > 0 %}
                    <div class="detalle-item">
                        <i class="bi bi-exclamation-circle-fill text-warning"></i>
                        <span>{{ stats.altas }} alerta(s) de alta prioridad - Atender en 24h</span>
                    </div>
                    {% endif %}
                    {% if stats.medias > 0 %}
                    <div class="detalle-item">
                        <i class="bi bi-info-circle-fill" style="color: #ffc107;"></i>
                        <span>{{ stats.medias }} alerta(s) de media prioridad</span>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-lg-6 mb-4">
            <div class="estado-visual">
                <div class="sistema-alerta-icon">
                    <i class="bi bi-exclamation-triangle"></i>
                </div>
                <h3 class="sistema-alerta-text">Alertas Detectadas</h3>
                <p class="sistema-alerta-descripcion">Revisar y resolver</p>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Secci贸n: Niveles de Prioridad -->
<div class="container-fluid prioridades-section">
    <div class="section-header text-center">
        <span class="section-label">Clasificaci贸n de Alertas</span>
        <h2 class="section-title">Niveles de Prioridad</h2>
    </div>

    <div class="row mt-5">
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="prioridad-card prioridad-critica">
                <div class="prioridad-icon">
                    <i class="bi bi-exclamation-triangle-fill"></i>
                </div>
                <h4 class="prioridad-titulo">Cr铆tica</h4>
                <p class="prioridad-descripcion">
                    Requiere acci贸n inmediata. Afecta operaciones principales del negocio.
                </p>
                <div class="prioridad-tiempo">
                    <span>Tiempo de respuesta: Inmediato</span>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6 mb-4">
            <div class="prioridad-card prioridad-alta">
                <div class="prioridad-icon">
                    <i class="bi bi-exclamation-circle-fill"></i>
                </div>
                <h4 class="prioridad-titulo">Alta</h4>
                <p class="prioridad-descripcion">
                    Atenci贸n necesaria en 24 horas. Puede generar problemas operativos.
                </p>
                <div class="prioridad-tiempo">
                    <span>Tiempo de respuesta: 24 horas</span>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6 mb-4">
            <div class="prioridad-card prioridad-media">
                <div class="prioridad-icon">
                    <i class="bi bi-info-circle-fill"></i>
                </div>
                <h4 class="prioridad-titulo">Media</h4>
                <p class="prioridad-descripcion">
                    Revisar en 48 horas. Situaciones que requieren seguimiento.
                </p>
                <div class="prioridad-tiempo">
                    <span>Tiempo de respuesta: 48 horas</span>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6 mb-4">
            <div class="prioridad-card prioridad-baja">
                <div class="prioridad-icon">
                    <i class="bi bi-bell-fill"></i>
                </div>
                <h4 class="prioridad-titulo">Baja</h4>
                <p class="prioridad-descripcion">
                    Informativa. No requiere acci贸n inmediata pero se debe revisar.
                </p>
                <div class="prioridad-tiempo">
                    <span>Tiempo de respuesta: 1 semana</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Secci贸n: Configuraci贸n de Notificaciones -->
<div class="container-fluid notificaciones-section">
    <div class="row align-items-center">
        <div class="col-lg-6 mb-4 order-lg-2">
            <div class="notif-visual">
                <div class="notif-icon-grande">
                    <i class="bi bi-envelope-check"></i>
                </div>
            </div>
        </div>
        <div class="col-lg-6 mb-4 order-lg-1">
            <div class="notif-content">
                <span class="section-label">Notificaciones</span>
                <h2 class="section-title">Sistema de Alertas Autom谩ticas</h2>
                <p class="section-description">
                    El sistema monitorea constantemente todas las operaciones y genera 
                    alertas autom谩ticas cuando detecta situaciones que requieren atenci贸n.
                </p>
                <div class="notif-canales">
                    <h5 class="notif-canales-titulo">Canales de Notificaci贸n:</h5>
                    <div class="canal-item">
                        <i class="bi bi-envelope-fill"></i>
                        <span>Correo electr贸nico</span>
                    </div>
                    <div class="canal-item">
                        <i class="bi bi-phone-fill"></i>
                        <span>SMS</span>
                    </div>
                    <div class="canal-item">
                        <i class="bi bi-bell-fill"></i>
                        <span>Notificaciones del sistema</span>
                    </div>
                    <div class="canal-item">
                        <i class="bi bi-app-indicator"></i>
                        <span>Panel de control</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}