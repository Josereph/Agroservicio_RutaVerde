{% extends "layouts/base.html" %}

{% block title %}Agroservicio Ruta Verde - Gestión de Servicios{% endblock %}

{% block content %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/vista2.css') }}">
        
    <div class="container mt-5">
        <h1 class="mb-4 display-4 text-primary-green">Gestión de Servicios</h1>

        <ul class="nav nav-tabs" id="serviciosTab" role="tablist">
            <li class="nav-item" role="presentation">

                
                <button class="nav-link *active* tab-link" id="registro-tab" data-bs-toggle="tab" data-bs-target="#registro" type="button" role="tab" aria-controls="registro" aria-selected="true">

                    Registrar Nuevo Servicio
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link tab-link" id="consulta-tab" data-bs-toggle="tab" data-bs-target="#consulta" type="button" role="tab" aria-controls="consulta" aria-selected="false">
                    Servicios Existentes
                </button>
            </li>
        </ul>

        <div class="tab-content tab-content-card" id="serviciosTabContent">

            
            <div class="tab-pane fade *show active*" id="registro" role="tabpanel" aria-labelledby="registro-tab">
                <h2 class="h5 mb-4 text-secondary-title">Completa los datos para registrar un nuevo envío:</h2>
                
                <form action="#" method="POST">
                    <div class="row g-4">
                        <div class="col-12"><h3 class="h6 text-section-header">Información del Cliente y Contacto</h3></div>
                        
                        <div class="col-md-4">
                            <label for="cliente_nombre" class="form-label text-inter-regular">Nombre del Cliente</label>
                            <input type="text" class="form-control custom-input" id="cliente_nombre" name="cliente_nombre" placeholder="Nombre completo" required>
                        </div>
                        
                        <div class="col-md-4">
                            <label for="cliente_email" class="form-label text-inter-regular">Correo Electrónico (Para Cliente)</label>
                            <input type="email" class="form-control custom-input" id="cliente_email" name="cliente_email" placeholder="Para factura y notificaciones" required>
                        </div>

                        <div class="col-md-4">
                            <label for="cliente_dui" class="form-label text-inter-regular">DUI de Cliente/Empresa</label>
                            <input type="text" class="form-control custom-input" id="cliente_dui" name="cliente_dui" placeholder="Documento Único de Identidad" required>
                        </div>

                        <div class="col-12"><h3 class="h6 text-section-header mt-3">Detalles de la Carga</h3></div>
                        
                        <div class="col-md-4">
                            <label for="tipo_servicio" class="form-label text-inter-regular">Tipo de Servicio</label>
                            <select class="form-select custom-input" id="tipo_servicio" name="tipo_servicio" required>
                                <option value="">Seleccione...</option>
                                <option value="1">Entrega de producto</option>
                                <option value="2">Retiro de producto</option>
                            </select>
                        </div>

        <!-- TIPO SERVICIO -->
        <div class="col-md-6">
            <label class="form-label">Tipo de Servicio</label>
            <select class="form-select" name="Id_Tipo_Servicio" required>
                <option value="">Seleccione...</option>
                {% for ts in tipos_servicio %}
                    <option value="{{ ts.Id_Tipo_Servicio }}">{{ ts.Nombre_Servicio }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- FRAGILIDAD -->
        <div class="col-md-6">
            <label class="form-label">Nivel de Fragilidad</label>
            <select class="form-select" name="Id_Fragilidad" required>
                <option value="">Seleccione...</option>
                {% for f in fragilidades %}
                    <option value="{{ f.Id_Fragilidad }}">{{ f.Nivel }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- UBICACION -->
        <div class="col-md-6">
            <label class="form-label">Ubicación Logística</label>
            <select class="form-select" name="Id_Ubicacion" required>
                <option value="">Seleccione...</option>
                {% for u in ubicaciones %}
                    <option value="{{ u.Id_Ubicacion }}">
                        UB-{{ u.Id_Ubicacion }} | {{ u.municipio.Nombre_Municipio }} ({{ u.departamento.Nombre_Departamento }})
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- PESO -->
        <div class="col-md-6">
            <label class="form-label">Peso de la Carga (kg)</label>
            <input type="number" step="0.01" name="Peso_Carga" class="form-control" required>
        </div>

        <!-- PRECIO -->
        <div class="col-md-6">
            <label class="form-label">Precio Total ($)</label>
            <input type="number" step="0.01" name="Precio_Total" class="form-control" required>
        </div>

        <!-- FECHAS -->
        <div class="col-md-6">
            <label class="form-label">Fecha de Pedido</label>
            <input type="date" name="Fecha_Pedido" class="form-control" required>
        </div>

        <div class="col-md-6">
            <label class="form-label">Fecha de Entrega</label>
            <input type="date" name="Fecha_Entrega" class="form-control" required>
        </div>

        <!-- BOTÓN -->
        <div class="col-12 mt-4 text-end">
            <button type="submit" class="btn btn-lg btn-primary">
                Registrar Servicio
            </button>
        </div>

    </div>
</form>

                        <div class="col-md-6">
                            <label for="precio_total" class="form-label text-inter-regular">Precio Total ($)</label>
                            <input type="number" step="0.01" class="form-control custom-input" id="precio_total" name="precio_total" min="0.00" placeholder="0.00" required>
                        </div>

                        <div class="col-md-6">
                            <label for="metodo_pago" class="form-label text-inter-regular">Método de Pago</label>
                            <select class="form-select custom-input" id="metodo_pago" name="metodo_pago" required>
                                <option value="">Seleccione...</option>
                                <option value="efectivo">Efectivo</option>
                                <option value="tarjeta">Tarjeta</option>
                                <option value="transferencia">Transferencia Bancaria</option>
                            </select>
                        </div>

                        <div class="col-12 mt-4">
                            <button type="submit" class="btn btn-lg w-100 primary-submit-btn">
                                <i></i> Registrar Servicio
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <div class="tab-pane fade" id="consulta" role="tabpanel" aria-labelledby="consulta-tab">
                <h2 class="h5 mb-4 text-secondary-title">Listado de Envíos y su Estado:</h2>
                
                <div class="row mb-3 align-items-center">
                    <div class="col-md-4">
                        <input type="text" class="form-control custom-input" placeholder="Buscar por ID, Cliente o Estado...">
                    </div>
                    <div class="col-md-8 text-end">
                        <button class="btn btn-outline-secondary me-2 btn-secondary-action">Filtrar por Estado</button>
                        <button class="btn btn-outline-secondary btn-secondary-action">Exportar Reporte</button>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table table-hover align-middle custom-table">
                        <thead class="thead-custom">
                            <tr>
                                <th>ID Servicio</th>
                                <th>Cliente (DUI)</th>
                                <th>Producto/Carga</th>
                                <th>Origen/Destino</th>
                                <th>Precio Total</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>SRV-001</td>
                                <td>José Diego C.</td>
                                <td>Semilla Maíz</td>
                                <td>2025-11-28</td>
                                <td><span class="badge bg-warning text-dark">En Camión</span></td>
                                <!-- CORRECCIÓN: Usar d-flex y gap-1 para asegurar la alineación horizontal -->
                                <td>
                                    <button class="btn btn-sm btn-success me-1" title="Editar Servicio"><i>Editar</i></button>
                                    <button class="btn btn-sm btn-danger" title="Eliminar Servicio"><i>Eliminar</i></button>
                                </td>
                            </tr>
                            <tr>
                                <td>SRV-002</td>
                                <td>René A. Hernández</td>
                                <td>Abono Orgánico</td>
                                <td>2025-11-20</td>
                                <td><span class="badge bg-primary">En Ruta</span></td>
                                <!-- CORRECCIÓN: Usar d-flex y gap-1 -->
                                <td>
                                    <button class="btn btn-sm btn-success me-1"><i>Editar</i></button>
                                    <button class="btn btn-sm btn-danger"><i>Eliminar</i></button>
                                </td>
                            </tr>
                            <tr>
                                <td>SRV-003</td>
                                <td>Joseph Orellana</td>
                                <td>Fertilizante Líquido</td>
                                <td>2025-11-15</td>
                                <td><span class="badge bg-success">Entregado</span></td>
                                <!-- CORRECCIÓN: Usar d-flex y gap-1 (botones deshabilitados) -->
                                <td>
                                    <button class="btn btn-sm btn-success me-1" disabled><i>Editar</i></button>
                                    <button class="btn btn-sm btn-danger" disabled><i>Eliminar</i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/Validacion.js') }}" defer></script>
{% endblock %}